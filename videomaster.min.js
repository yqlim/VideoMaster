"use strict";var _createClass=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(){!function(){for(var o=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"]||window[t[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var i=(new Date).getTime(),n=Math.max(0,16-(i-o)),s=window.setTimeout(function(){t(i+n)},n);return o=i+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var VideoMaster=function(){function VideoMaster(t,e){var i=this,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,VideoMaster);var s=function(t){return"VideoMaster: "+t};if(!t)throw new SyntaxError(s("Container is not specified."));if(!e)throw new SyntaxError(s("Video source is not specified."));if(this.container="string"==typeof t?document.querySelector(t):t,!this.container)throw new Error(s("Container is not found."));if(Object.getPrototypeOf(this.container.constructor)!==HTMLElement)throw new TypeError(s("Container is not a DOM Element."));if("string"!=typeof e)throw new TypeError(s("Video source must be typeof string."));for(var o in this.src=e,this.config={loop:!1,muted:!1,volume:1,objectFit:"contain",useCanvas:!1,forceCanvasOniOS:!0,resetOnEnded:!1,trigger:"click",canPause:!0,shortcut:!0,seekFactor:5,onEnded:function(){}},n)this.config[o]=n[o];if(function(t){for(var e in t)if(void 0!==i.config[e]&&null!==i.config[e]&&i.config[e].constructor!==t[e])throw new TypeError(s('Invalid "'+e+'" property value. Only values of '+t[e].toString().match(/[A-Z]\w{1,}/)[0]+" constructor are accepted."))}({loop:Boolean,muted:Boolean,volume:Number,useCanvas:Boolean,forceCanvasOniOS:Boolean,resetOnEnded:Boolean,trigger:String,canPause:Boolean,objectFit:String,onEnded:Function,shortcut:Boolean,seekFactor:Number}),this.state={inited:!1,sized:!1,resized:!1,playing:!1,ended:!1,lastTime:0,animationFrame:null},this.ctx=null,this.video=null,this.canvas=null,this.audio=null,this.width=0,this.height=0,this.config.forceCanvasOniOS){var a=/iphone|ipad|ipod/i.test(window.navigator.userAgent);this.config.useCanvas=a||this.config.useCanvas}this.container.style.overflow="hidden","static"===window.getComputedStyle(this.container).position&&(this.container.style.position="relative");var r=(this.container.id?this.container.id+"-":"")+"VideoMaster",h=this.src.split(".").pop();if(this.video=document.createElement("video"),this.video.setAttribute("id",r),this.video.style.position="absolute",this.video.innerHTML='<source src="'+this.src+'" type="video/'+h+'">',this.container.appendChild(this.video),this.config.useCanvas){var d=r+"-canvas";this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id",d),this.canvas.style.position="absolute",this.container.appendChild(this.canvas),this.audio=document.createElement("audio"),this.audio.innerHTML=this.video.innerHTML,this.container.appendChild(this.audio,this.video),this.audio.load(),this.ctx=this.canvas.getContext("2d"),this.video.addEventListener("timeupdate",this.drawFrame.bind(this)),this.video.addEventListener("loadeddata",this.drawFrame.bind(this))}this.volume=this.config.volume,this.video.addEventListener("loadedmetadata",this.updateSize.bind(this)),this.video.addEventListener("ended",function(){this.state.ended=!0,this.config.loop?this.play():(this.state.playing=!1,this.config.resetOnEnded&&this.goTo(0))}.bind(this)),this.video.addEventListener("ended",this.config.onEnded.bind(this)),this.container.addEventListener(this.config.trigger,this.init.bind(this)),window.addEventListener("resize",this.updateSize.bind(this)),this.config.shortcut&&window.addEventListener("keydown",function(t){if(!this.state.inited)return;switch(t.which){case 32:this.togglePlay();break;case 37:this.goTo(this.currentTime-this.config.seekFactor);break;case 39:this.goTo(this.currentTime+this.config.seekFactor)}}.bind(this)),this.video.load()}return _createClass(VideoMaster,[{key:"init",value:function(){if(this.state.sized||this.updateSize(),this.config.canPause&&this.state.inited)return this.togglePlay();this.config.useCanvas&&(this.video.style.display="none"),this.state.inited=!0,this.play()}},{key:"updateSize",value:function(){if(this.video.videoHeight){var e=void 0,i=void 0,t=void 0,n=void 0,s=void 0,o=this.container.clientWidth,a=this.container.clientHeight,r=this.video.videoWidth,h=this.video.videoHeight,d=!1,u=!1;this.width=o,this.height="cover"!==this.config.objectFit?h*(o/r):a,this.video.setAttribute("width",this.width),this.video.setAttribute("height",this.height),this.config.useCanvas&&(this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height)),"cover"===this.config.objectFit?h*(t=o/r)<a?(e=r*(t=a/h),i=a,d=!(n=0)):(e=o,i=h*t,u=!(s=0)):"contain"===this.config.objectFit&&(a<h*(t=o/r)?(e=r*(t=a/h),i=a,d=!(n=0)):(e=o,i=h*t,u=!(s=0))),u?n=(a-i)/2:d&&(s=(o-e)/2),this.config.useCanvas?(c.call(this,this.canvas),this.drawFrame(),this.video.style.display="none"):c.call(this,this.video),this.state.sized=!0}else this.state.resized=!0;function c(t){t.style.top=n+"px",t.style.left=s+"px","cover"===this.config.objectFit&&(t.style.width=e+"px",t.style.height=i+"px")}}},{key:"play",value:function(){this.state.playing=!0,this.state.sized||this.updateSize(),this.state.ended&&(this.state.ended=!1,this.goTo(0)),this.config.useCanvas?(this.state.lastTime=Date.now(),this.roll(),this.audio.play(),this.audio.muted=this.config.muted):(this.video.play(),this.video.muted=this.config.muted)}},{key:"pause",value:function(){this.config.canPause&&(this.state.playing=!1,this.config.useCanvas?this.audio.pause():this.video.pause())}},{key:"togglePlay",value:function(){this.state.playing?this.pause():this.play()}},{key:"goTo",value:function(t){this.video.currentTime=t,this.config.useCanvas&&this.sync()}},{key:"roll",value:function(){var t=Date.now(),e=(t-this.state.lastTime)/1e3;1/30<=e&&(this.video.currentTime+=e,this.state.lastTime=t,.3<Math.abs(this.audio.currentTime-this.video.currentTime)&&this.sync()),this.state.playing?this.state.animationFrame=window.requestAnimationFrame(this.roll.bind(this)):window.cancelAnimationFrame(this.state.animationFrame)}},{key:"sync",value:function(){this.audio.currentTime=this.video.currentTime}},{key:"drawFrame",value:function(){this.ctx.drawImage(this.video,0,0,this.width,this.height)}},{key:"addEventListener",value:function(){var t=this.config.useCanvas?this.canvas:this.video;t.addEventListener.apply(t,arguments)}},{key:"removeEventListener",value:function(){var t=this.config.useCanvas?this.canvas:this.video;t.removeEventListener.apply(t,arguments)}},{key:"on",value:function(){this.addEventListener.apply(this,arguments)}},{key:"off",value:function(){this.removeEventListener.apply(this,arguments)}},{key:"muted",get:function(){return this.config.useCanvas?this.audio.muted:this.video.muted},set:function(t){if("boolean"!=typeof t)throw new TypeError('VideoMaster: Must use boolean to set ".muted" property.');this.config.useCanvas?this.audio.muted=t:this.video.muted=t}},{key:"volume",get:function(){return this.config.useCanvas?this.audio.volume:this.video.volume},set:function(t){if("number"!=typeof t)throw new TypeError('VideoMaster: "volume" property must be a number between 0 to 1.');if(t<0||1<t)throw new RangeError('VideoMaster: "volume" property must be a number between 0 to 1.');this.config.useCanvas?this.audio.volume=t:this.video.volume=t}},{key:"currentTime",get:function(){return this.video.currentTime},set:function(t){if("number"!=typeof t)throw new TypeError('VideoMaster: "currentTime" property must be a number.');if(t>this.video.duration)throw new RangeError('VideoMaster: New "currentTime" value exceeded video duration.');this.goTo(t)}},{key:"paused",get:function(){return!this.state.playing}},{key:"duration",get:function(){return this.video.duration}}]),VideoMaster}();window.VideoMaster=VideoMaster}();